<h1>Productos</h1>

<% if flash[:notice] %>
  <div class="alert alert-success">
    <%= flash[:notice] %>
  </div>
<% end %>
<% if flash[:alert] %>
   <div class="alert alert-danger">
    <%= flash[:alert] %>
  </div>
<% end %>

<div class="bg-red-500 text-white p-4">
  Esto no debería verse acá, arregla el link u.u
</div>


<%= form_with(url: special_view_products_path, method: :get, class: 'form-inline my-3') do %>
  <div class="form-group mr-2">
    <%= label_tag :name, 'Nombre: ', class: 'form-label' %>
    <%= text_field_tag :name, params[:name], class: 'form-control' %>
  </div>
  <div class="form-group mr-2">
    <%= label_tag :description, 'Descripción: ', class: 'form-label' %>
    <%= text_field_tag :description, params[:description], class: 'form-control' %>
  </div>
  <div class="form-group mr-2">
    <%= label_tag :category_id, 'Categoría: ', class: 'form-label' %>
    <%= select_tag :category_id, options_from_collection_for_select(Category.all, :id, :name, params[:category_id]), prompt: "Selecciona una categoría", class: 'form-control' %>
  </div>
  <%= submit_tag 'Buscar', class: 'btn btn-secondary' %>
<% end %>

<div class="row">
  <% @products.each do |product| %>
    <div class="col-12 col-sm-6 col-lg-4 mb-4 d-flex">
      <div class="card h-100 w-100">
        <% if product.image.attached? %>
          <%= image_tag product.image, class: "card-img-top" %>
        <% else %>
          <p class="text-center mt-2">Imagen no disponible</p>
        <% end %>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title"><%= product.name %></h5>
          <p class="card-text"><%= product.description %></p>
          <p><strong>$<%= product.price %></strong></p>
          <p>Stock: <%= product.stock %> unidades</p>
        </div>

        <div class="card-footer mt-auto">
          <% if customer_signed_in? %>
            <%= form_with url: cart_cart_items_path, method: :post, local: true do |f| %>
              <%= hidden_field_tag :product_id, product.id %>
              <%= number_field_tag :quantity, 1, min: 1, class: "form-control mb-2" %>
              <%= f.submit "Agregar al carrito", class: "btn btn-primary w-100" %>
            <% end %>
          <% else %>
            <p><em>Inicia sesión como cliente para comprar</em></p>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>


